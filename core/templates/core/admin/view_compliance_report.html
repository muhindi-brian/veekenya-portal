{% extends 'core/base.html' %}

{% block title %}View Compliance Report - VeeKenya{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <div class="mb-8 flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">{{ report.get_report_type_display }}</h1>
                <p class="text-gray-600">Generated on {{ report.generated_at|date:"Y-m-d H:i" }} by {{ report.generated_by.username }}</p>
            </div>
            <div>
                <a href="{% url 'generate_compliance_report' %}" class="text-indigo-600 hover:text-indigo-900">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Reports
                </a>
            </div>
        </div>

        <!-- Report Details -->
        <div class="bg-white shadow-sm rounded-lg overflow-hidden">
            <!-- Report Header -->
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-500">Report Period</label>
                        <p class="mt-1 text-sm text-gray-900">
                            {{ report.report_period_start|date:"Y-m-d" }} to {{ report.report_period_end|date:"Y-m-d" }}
                        </p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-500">Report Type</label>
                        <p class="mt-1 text-sm text-gray-900">{{ report.get_report_type_display }}</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-500">Generated By</label>
                        <p class="mt-1 text-sm text-gray-900">{{ report.generated_by.username }}</p>
                    </div>
                </div>
            </div>

            <!-- Report Summary -->
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900 mb-2">Summary</h3>
                <p class="text-sm text-gray-600">{{ report.summary }}</p>
            </div>

            <!-- Report Data -->
            <div class="px-6 py-4">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Detailed Report</h3>
                
                {% if report.report_type == 'data_access' %}
                    <!-- Data Access Report -->
                    <div class="space-y-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Total Data Access Events</h4>
                            <p class="text-2xl font-bold text-indigo-600">{{ report.report_data.total_accesses }}</p>
                        </div>

                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Access by Operation Type</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <table class="min-w-full">
                                    <thead>
                                        <tr>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase">Operation</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase">Count</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        {% for item in report.report_data.access_by_type %}
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">{{ item.operation_type }}</td>
                                            <td class="py-2 text-sm text-gray-900 text-right">{{ item.count }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Access by Data Model</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <table class="min-w-full">
                                    <thead>
                                        <tr>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase">Model</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase">Count</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        {% for item in report.report_data.access_by_model %}
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">{{ item.data_model }}</td>
                                            <td class="py-2 text-sm text-gray-900 text-right">{{ item.count }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                {% elif report.report_type == 'user_activity' %}
                    <!-- User Activity Report -->
                    <div class="space-y-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Total Activities</h4>
                            <p class="text-2xl font-bold text-indigo-600">{{ report.report_data.total_activities }}</p>
                        </div>

                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Activities by Type</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <table class="min-w-full">
                                    <thead>
                                        <tr>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase">Activity Type</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase">Count</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        {% for item in report.report_data.activities_by_type %}
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">{{ item.action_type }}</td>
                                            <td class="py-2 text-sm text-gray-900 text-right">{{ item.count }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-sm font-medium text-gray-900 mb-2">Activities by Status</h4>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <table class="min-w-full">
                                    <thead>
                                        <tr>
                                            <th class="text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="text-right text-xs font-medium text-gray-500 uppercase">Count</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        {% for item in report.report_data.activities_by_status %}
                                        <tr>
                                            <td class="py-2 text-sm text-gray-900">{{ item.status }}</td>
                                            <td class="py-2 text-sm text-gray-900 text-right">{{ item.count }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                {% else %}
                    <!-- Generic Report Data Display -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <pre class="text-sm text-gray-600 whitespace-pre-wrap">{{ report.report_data|pprint }}</pre>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Export Options -->
        <div class="mt-8 flex justify-end space-x-4">
            <a href="#" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-file-pdf mr-2"></i>
                Export as PDF
            </a>
            <a href="#" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-file-csv mr-2"></i>
                Export as CSV
            </a>
        </div>
    </div>
</div>
{% endblock %} 